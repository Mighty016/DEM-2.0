<!DOCTYPE html>
<html>
    <head>
            <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
            crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

        <!------ Include the above in your HEAD tag ---------->


<style>
body {
            background-color: #000000;
        }

        .othersimg {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .h7 {
            font-size: 0.8rem;
        }

        .gedf-wrapper {
            margin-top: 0.97rem;
        }

        @media (min-width: 992px) {
            .gedf-main {
                padding-left: 4rem;
                padding-right: 4rem;
            }
            .gedf-card {
                margin-bottom: 2.77rem;
            }
        }

        .nav-link::after{
            content: "";
            display: block;
            width: 0;
            height: 3px;
            background: rgb(0, 0, 0);
            transition: width .3s;
        }

        .nav-link:hover::after{
            width: 100%;
            transition: width .3s;
        }

        /**Reset Bootstrap*/
        .dropdown-toggle::after {
            content: none;
        }

        /* The Modal (background) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        /* Modal Content */
        .modal-content {
            position: relative;
            background-color: #fefefe;
            margin: auto;
            padding: 0;
            border: 1px solid #888;
            width: 50%;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
            -webkit-animation-name: animatetop;
            -webkit-animation-duration: 0.4s;
            animation-name: animatetop;
            animation-duration: 0.4s
        }

        /* Add Animation */
        @-webkit-keyframes animatetop {
          from {top:-300px; opacity:0}
          to {top:0; opacity:1}
        }

        @keyframes animatetop {
          from {top:-300px; opacity:0}
          to {top:0; opacity:1}
        }

        /* The Close Button */
        .close {
          color: rgb(0, 0, 0);
          float: right;
          font-size: 28px;
          font-weight: bold;
        }

        .close:hover,
        .close:focus {
          color: #000;
          text-decoration: none;
          cursor: pointer;
        }

        </style>
    </head>
    <body>
        <!-- A vertical navbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="feed.html"><img src="..\dem2.0\images\demlogo.png" width="55px" height="55px"></a>
            <hr style="width: 1px; height: 35px; background: rgb(53, 53, 53); border: none;" />
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="true" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="feed.html"><b>Home</b><span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Calendar</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="Club.html">Club</a>
                    </li>

                <!--<li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Dropdown
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item" href="#">Another action</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </li> -->
                <!--<li class="nav-item">
                    <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
                </li> -->
                </ul>
                <!-- <form class="form-inline my-2 my-lg-0">
                    <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
                </form> -->

                <li style="list-style-type:none">
                    <form class="form-inline">
                    <div class="input-group">
                        <input type="text" class="form-control" aria-label="Recipient's username" aria-describedby="button-addon2">
                        <div class="input-group-append">
                            <button class="btn btn-outline-primary" type="button" id="button-addon2">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </div>
                </form>
                </li>
                <li style="list-style-type:none">
                  <button id="clubLogout" class="btn btn-danger">Logout</button>
                </li>
            </div>

        </nav>


<!--<nav class="navbar navbar-light bg-white">
        <a href="#" class="navbar-brand">Bootsbook</a>
        <form class="form-inline">
            <div class="input-group">
                <input type="text" class="form-control" aria-label="Recipient's username" aria-describedby="button-addon2">
                <div class="input-group-append">
                    <button class="btn btn-outline-primary" type="button" id="button-addon2">
                        <i class="fa fa-search"></i>
                    </button>
                </div>
            </div>
        </form>
    </nav> -->


    <div class="container-fluid gedf-wrapper">
        <div class="row">
            <div class="col-md-3">
                <div class="card gedf-card">
                    <div class="card-body">
                        <div id="ProfilePic"><img class="othersimg rounded-circle" src="..\dem2.0\images\ymer.jpg" width="50%" height="50%"></div><hr/>
                        <div id="Name" class="h5" align="center">Amir Shaari</div>
                        <div id="MatrixID" class="h7 text-muted" align="center">2017232746</div>
                        <div id="FacName" class="h7 text-muted" align="center">Student of Diploma Computer Sciences</div>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <div class="h6 text-muted">Email</div>
                            <div id="Email" class="h5">amirshaari45@gmail.com</div>
                        </li>
                    </ul>
                </div>
                <div id="clubLoginBtn" class="card gedf-card">
                        <div class="card-body">
                            <div id="Clublogin" class="h5">Login Club</div>
                            <button  id="myBtn" class="btn btn-primary">Login</button>
                        </div>
                </div>

                <!-- The Modal -->
                <div id="myModal" class="modal">
                    <!-- Modal content -->
                    <div class="modal-content">
                        <div class="card-header">
                            <span class="close">&times;</span>
                            <h1 align="center">Club Login</h1>
                        </div>
                        <form action="" method="post" >
                            <div class="card-body">

                                <input type="text" id="ClubID" name="ClubID" placeholder="Club ID" class="form-control"><br>
                                <input type="password" id="ClubPswd" name="ClubPswd" placeholder="Club Password" class="form-control">

                            </div>
                            <div class="card-footer">
                                <input type="button" id="clubLoginSubmit" name="submit" value="Log In" class="btn btn-primary">

                            </div>
                        </form>
                    </div>

                </div>


                <!--<div id="id02" class="modal">
                    <!--This is the sign up form
                    <form class="modal-content1 animate" method="POST" action="loginClub.php">
                      <div class="card-body">
                      </div>
                      <div class="card gedf-card" width="20%">
                        <h1>Club Log In</h1>
                            <input type="text" id="clubid" name="clubid" placeholder="Club ID" class="form-control">
                            <input type="password" id="clubpswd" name="clubpswd" placeholder="Club Password" class="form-control">
                            <input type="submit" name="submit" value="Log In" class="btn btn-primary">
                      </div>
                    </form>
                </form>
                </div>-->


                     <div id="clubInfo" class="card gedf-card">
                        <div class="card-body">
                            <div id="ClubInfoLogo"><img src="images/test.png" width="25%" height="25%"></div>
                            <div id="ClubInfoName" class="h5">High Achievers' Club</div>
                        </div>

                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <div class="h6 text-muted">Email</div>
                            <div id="ClubInfoEmail" class="h5">HAC@gmail.com</div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-md-6 gedf-main">

                <!-- Post an activity card-->
               <div id="clubAddPost" class="card gedf-card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="posts-tab" data-toggle="tab" href="#posts" role="tab" aria-controls="posts" aria-selected="true">Post an
                                Activity</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="images-tab" data-toggle="tab" role="tab" aria-controls="images" aria-selected="false" href="#images">Images</a>
                            </li>
                        </ul>
                     </div>
                    <div class="card-body">
                        <div class="tab-content" id="myTabContent">
                            <div class="tab-pane fade show active" id="posts" role="tabpanel" aria-labelledby="posts-tab">
                                <div class="form-group">
                                    <label class="sr-only" for="message">post</label>
                                    <textarea class="form-control" id="message" rows="3" placeholder="What are you thinking?"></textarea>
                                    <input type="hidden" id="feedID" value="-1">
                                </div>
                                <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="customFile">
                                        <label class="custom-file-label" for="customFile">Upload image</label>
                                    </div>

                            </div>
                                <div class="tab-pane fade" id="images" role="tabpanel" aria-labelledby="images-tab">
                                <div class="form-group">
                                    <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="customFile">
                                        <label class="custom-file-label" for="customFile">Upload image</label>
                                    </div>
                                </div>
                                <div class="py-4"></div>
                            </div>
                        </div><br>
                        <div class="btn-toolbar justify-content-between">
                            <div class="btn-group">
                                <button class="btn btn-primary" id="addPost">Post</button>
                                <button class="btn btn-danger" id="cancelEdit">Cancel Edit</button>
                            </div>
                            <div class="btn-group">
                                <button id="btnGroupDrop1" type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                                    aria-expanded="false">
                                    <i class="fa fa-globe"></i>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="btnGroupDrop1">
                                    <a class="dropdown-item" href="#"><i class="fa fa-globe"></i> Public</a>
                                    <a class="dropdown-item" href="#"><i class="fa fa-users"></i> Friends</a>
                                    <a class="dropdown-item" href="#"><i class="fa fa-user"></i> Just me</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Post /////-->

                <!--- \\\\\\\Post-->
                <div id="postJS">

                </div>

                <!-- Post /////-->


                <!--UITM LINKS CARD-->
            </div>
            <div class="col-md-3">
                <div class="card gedf-card">
                    <div class="card-body">
                        <h5 class="card-title" align="center">UiTM Links</h5>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <a href="https://istudent.uitm.edu.my/isp/index_isp.htm"><img class="othersimg"src="..\dem2.0\images\istudent.png" width="70%" height="70%"></a>
                                </li>
                            </ul>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <a href="https://i-learn.uitm.edu.my/login"><img class="othersimg" src="..\dem2.0\images\ilearn.png" width="50%" height="50%"></a>
                                </li>
                            </ul>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <a href="https://koleksi.uitm.edu.my/eqps/"><img class="othersimg" src="..\dem2.0\images\EQPS.png" width="25%" height="25%"></a>
                                </li>
                            </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </body>

    <script>
    // Get the modal
    var modal = document.getElementById("myModal");

    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks the button, open the modal
    btn.onclick = function() {
      modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
      modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }

    //club login
    var clubData = null;

    $("#clubInfo").css("display","none");
    $("#clubLoginBtn").css("display","block");
    $("#clubLoginSubmit").on("click",(event)=>{
        let clubName = $("#ClubID").val();
        let clubPswd = $("#ClubPswd").val();
        console.log("name :",clubName," pswd : ",clubPswd);
        $.post("loginClub.php",{
            clubName:clubName,
            clubPswd:clubPswd
        },(data)=>{
            data = JSON.parse(data)[0];
            console.log(typeof data," : ",data);
            if(typeof data == "object"){
                localStorage.setItem("clubData",JSON.stringify(data));
                getClubData();
                loadPost();
                modal.style.display = "none";

            }else{
                alert(data);
            }

        });
    });


    function getClubData(){
      try {
        clubData = JSON.parse(localStorage.getItem("clubData"));
        console.log(typeof clubData,clubData);

        if(clubData != null){
          $("#clubInfo").css("display","block");
          $("#clubLoginBtn").css("display","block");
          $("#ClubInfoName").html(clubData.clubName);
          $("#ClubInfoEmail").html(clubData.clubEmail);
          $("#clubAddPost").css("display","block");
        }
        // console.log("userdata : ",);
      } catch (e) {
        alert(e);
      }
    }



    var userData = null;
    try {
      userData = JSON.parse(localStorage.getItem("userData"));
      console.log("userdata : ",userData);
      // console.log("userdata : ",);
    } catch (e) {
      alert(e);
    }
    getClubData();

    //afiqjquery
    $("#Name").html(userData.userName);
    $("#MatrixID").html(userData.userID);
    $("#Email").html(userData.email);
    $("#FacName").html(userData.departmentDesc);

    $("#addPost").on("click",function(event){
      console.log("test");
      var clubID = clubData.clubID;
      var message = $("#message").val();
      console.log(clubID,message,"haha",$("#feedID").val());

      $.post(($("#feedID").val() == -1 ? "addpost.php" : "editpost.php" ),{clubID:clubID,post:message,submit:"haha",feedID:$("#feedID").val()},(data)=>{
        alert(data);
        loadPost();
        $("#message").val("");
        $("#feedID").val(-1)
        $("#cancelEdit").css("display","none");
      })
    })
    var postData = null;
    function loadPost(){
      $.getJSON("post.php",(data)=>{
        console.log(typeof data,data);
        postData = data.reverse();
      }).then(()=>{
        if(postData != null){
          html ="";
          postData.forEach((val,index,array)=>{

            html += `<div class="card gedf-card">
                  <div class="card-header">
                      <div class="d-flex justify-content-between align-items-center">
                          <div class="d-flex justify-content-between align-items-center">
                              <div class="mr-2">
                                  <img class="rounded-circle" width="45" src="https://picsum.photos/50/50" alt="">
                              </div>
                              <div class="ml-2">
                                  <div class="h5 m-0" id="ClubName">${val.clubName}</div>
                                  <div class="h7 text-muted" id="ClubEmail">${val.clubEmail}</div>
                              </div>
                          </div>
                          <div>
                              <div class="dropdown">`;
                          if(clubData)
                                  html += (clubData.clubID == val.clubID ? `<button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                      <i class="fa fa-ellipsis-h"></i>
                                  </button>
                                  <div class="dropdown-menu dropdown-menu-right" aria-labelledby="gedf-drop1">
                                      <a class="dropdown-item" href="#myTabContent" onclick="editPost(${index})">Edit</a>
                                      <a class="dropdown-item" onclick="deletePost(${index})">Delete</a>
                                  </div>`:``)
                                  html+=`
                              </div>
                          </div>
                      </div>

                  </div>
                  <div class="card-body">
                      <div class="text-muted h7 mb-2"> <i class="fa fa-clock-o"></i>10 min ago</div>
                      <a class="card-link" href="#">
                          <h5 class="card-title">${val.actName}</h5>
                      </a>

                      <p class="card-text">
                          ${val.feedDesc}
                      </p>
                  </div>

              </div>`;
          });
          $("#postJS").html(html);
        };
      })
    }
    loadPost();
    $("#cancelEdit").css("display","none");
    $("#cancelEdit").on("click",(event)=>{
        $("#cancelEdit").css("display","none");
        $("#feedID").val(-1);
        $("#message").val("");

    })
    function editPost(postIndex){
      console.log(postIndex);
      $("#message").val(postData[postIndex].feedDesc);
      $("#feedID").val(postData[postIndex].feedID);
      $("#cancelEdit").css("display","block");
    }
    function deletePost(postIndex){
      if(confirm("are you sure?")){
        $.post("deletepost.php",{id:postData[postIndex].feedID},(data)=>{
          alert(data);
          loadPost();
        })
      }
    }
    $("#clubLogout").on("click",()=>{
      $.post("logout.php",(data)=>{
        alert("logged out",data);
        localStorage.removeItem("userData");
        localStorage.removeItem("clubData");
        location.href="login.html";
      })
    })
    if(clubData == null){
      $("#clubAddPost").css("display","none");
    }
    </script>

</html>
